LiSP の息抜きにちょっこと Forth でも作ってみる。

jonesforth
http://annexia.org/forth


%rax Return value
%rbx Callee saved
%rcx 4th argument
%rdx 3rd argument
%rsi 2nd argument
%rdi 1st argument
%rbp Callee saved
%rsp Stack pointer
%r8  5th argument
%r9  6th argument
%r10 Callee saved
%r11 Used for linking
%r12 Unused for C
%r13 Callee saved
%r14 Callee saved
%r15 Callee saved


<<Direct Threaded Code>>
DOUBLE:
        PUSHRSP rsi
        mov     rsi,    .code + 8
        jmp     .code
.code:
        DUP
        PLUS
        EXIT
DUP:
        mov     rax,    rsp
        push    rax
        NEXT
EXIT:
        POPRSP  rsi
        NEXT

<<Indirect Threaded Code>>
DOUBLE:
        DOCOL                   ; codeword
        DUP
        PLUS
        EXIT
DUP:
        DUP_code                ; codeword
DUP_code:
        mov     rax,    rsp
        push    rax
        NEXT
EXIT:
        EXIT_code               ; codeword
EXIT_code:
        POPRSP  rsi
        NEXT
DOCOL:
        PUSHRSP rsi
        add     rax,    CELLL
        mov     rsi,    rax
        NEXT

